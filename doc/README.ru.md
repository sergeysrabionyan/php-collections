# PHP Коллекции

Библиотека для удобной работы с массивами данных различных структур с использованием функционального подхода. В основе лежат структуры данных, такие как: Список, Карта, Множество, Стек, Очередь. 

Для обхода и преобразования коллекций используется stream api (Stream), который обеспечивает более функциональный подход.

Читать на других языках: [English](../README.md)

## Установка

Установить и использовать библиотеку в собственном проекте можно использовав  менеджер зависимостей [Composer](https://getcomposer.org/)

```bash
composer require worksolutions/php-collections
``` 

## Пример использования
```php

use WS\Utils\Collections\CollectionFactory;
use WS\Utils\Collections\Functions\Predicates;

// Отобрать элементы по фильтру
CollectionFactory::from([1, 2, 3])
    ->stream()
    ->filter(Predicates::moreThan(1))
    ->getCollection(); // Collection [2, 3]

// Распечатать все файлы в директории
CollectionFactory::fromIterable(new DirectoryIterator(__DIR__))
    ->stream()
    ->each(static function (SplFileInfo $fileInfo) {
        echo $fileInfo->getFilename() . "\n";
    });

```

## Основные концепции

В основе использования библиотеки лежит последовательный подход обработки и преобразования данных. Создание некого конвейера преобразования, где можно последовательно выполнять некие шаги. Каждый шаг отвечает только за свой небольшой кусочек работы. В этом случае шаги можно переиспользовать так как они являются более наглядными.

Фундаментально библиотека состоит из нескольких частей, это: 

- [Структуры данных.](#Структуры-данных) Каждая имеет свою особенность, выраженную при помощи интерфейса и описания к нему, и реализацию. При этом реализации поведения структур данных могут быть разные.
- [Фабрика создания коллекции.](#Фабрика-создания-коллекции) Имеет множество статических методов для удобного создания коллекций.
- [Потоки обхода коллекций.](#Потоки-обхода-коллекций) Предназначен для обхода и преобразования коллекций, при этом каждое преобразование создает новый экземпляр коллекции.
- [Набор функций обхода и преобразования.](#Набор-функций-обхода-и-преобразования) Состоит из заранее подготовленных конструкторов функций для удобного использования в момент обхода. Можно создать использовать собственные функции более специфичные для вашей предметной области.

## Структуры данных

В основе библиотеки лежат самые популярные структуры данных которые являются самодостаточными для использования без каких-либо посторонних библиотек и классов. Все остальные части библиотеки основываются на эти структуры, в частности на интерфейс `Collection`. Все структуры данных коллекций содержат множество элементов с которыми можно проводить основные процедуры, такие как: обход, преобразование, агрегирования и т.д.

- [Коллекция (Collection)](#коллекция-collection)
- [Список (ListSequence)](#список-listsequence)

### Коллекция (Collection)

Основной базовый интерфейс коллекций. Все структуры данных кроме `карт (Map)` реализуют этот интерфейс, весь дополнительный функционал (Фабрики, Потоки обхода) используют данный интерфейс. Для поддержания универсальности в своих приложениях рекомендуется использовать именно интерфейс  `Collection`, но только в том случае если это не противоречит назначению использования структуры.

#### Методы интерфейса

- [*add* – Добавление элемента в коллекцию](#добавление-элемента-в-коллекцию)
- [*addAll* – Добавление множества элементов в коллекцию](#Добавление-множества-элементов-в-коллекцию)
- [*merge* – Слияние коллекций](#Слияние-коллекций)
- [*clear* – Удаление всех элементов коллекции](#Удаление-всех-элементов-коллекции)
- [*remove* – Удаление элемента коллекции](#Удаление-элемента-коллекции)
- [*contains* – Проверка на существование элемента в коллекции](#Проверка-на-существование-элемента-в-коллекции)
- [*equals* – Сравнение двух коллекций на эквивалентность](#Сравнение-двух-коллекций-на-эквивалентность)
- [*size* – Получение количества элементов в коллекции](#Получение-количества-элементов-в-коллекции)
- [*isEmpty* – Проверка коллекции на пустоту](#Проверка-коллекции-на-пустоту)
- [*toArray* – Получение элементов коллекции в виде массива](#Получение-элементов-коллекции-в-виде-массива)
- [*copy* – Получение копии коллекции](#Получение-копии-коллекции)
- [*stream* – Получение потока обхода коллекции (Stream)](#Получение-потока-обхода-коллекции-Stream)

#### Добавление элемента в коллекцию
```
add($element: mixed): bool;
```
Добавляет элемент в конец коллекции. Возвращает `true` в случае успешного ответа или `false` при неудаче.
```php

use WS\Utils\Collections\CollectionFactory;

$collection = CollectionFactory::from([1, 2]); // [1, 2]
$collection->add(10); // [1, 2] -> [1, 2, 10];

```
#### Добавление множества элементов в коллекцию
```
addAll($elements: iterable): bool;
```
Добавляет множества элементов в конец коллекции. Возвращает `true` в случае успешного ответа или `false` при неудаче.
```php

use WS\Utils\Collections\CollectionFactory;

$collection = CollectionFactory::from([1, 2]); // [1, 2]
$collection->add([10, 11, 12]); // true
$collection->toArray(); // [1, 2] -> [1, 2, 10, 11, 12];

```
#### Слияние коллекций
```
merge($collection: Collection): bool;
```
Метод объединяет текущую коллекцию с переданной. Возвращает `true` в случае успешного ответа или `false` при неудаче.
```php

use WS\Utils\Collections\CollectionFactory;

$collection = CollectionFactory::from([1, 2]); // [1, 2]
$mergingCollection = CollectionFactory::from([11, 12]); // [11, 12]
$collection->merge($mergingCollection); // true
$collection->toArray(); // [1, 2, 10, 11, 12];

```
#### Удаление всех элементов коллекции
```
clear(): void;
```
Метод удаляет все элементы коллекции.
```php

use WS\Utils\Collections\CollectionFactory;

$collection = CollectionFactory::from([1, 2]); // [1, 2]
$collection->clear(); // null
$collection->toArray(); // [];

```
#### Удаление элемента коллекции
```
remove($element: mixed): bool;
```

Удаление конкретного элемента в коллекции. Метод возвращает признак удаления элемента. Если элемента не существовало, вернется `false`.

```php

use WS\Utils\Collections\CollectionFactory;

$collection = CollectionFactory::from([1, 2, 3]); // [1, 2, 3]
$collection->remove(2); // true
$collection->remove(4); // false
$collection->toArray(); // [1, 3];

```
#### Проверка на существование элемента в коллекции
```
contains($element: mixed): bool;
```

Проверка наличия конкретного элемента в коллекции. Если элемента не существует, вернется `false`.

```php

use WS\Utils\Collections\CollectionFactory;

$collection = CollectionFactory::from([1, 2, 3]); // [1, 2, 3]
$collection->contains(2); // true
$collection->contains(4); // false

```
#### Сравнение двух коллекций на эквивалентность
```
equals($collection: Collection): bool;
```

Метод проверяет, что переданная коллекция эквивалентна текущей, это означает что все элементы одной коллекции содержатся в другой коллекции и количество элементов равно. В случае неравенства коллекций, вернется `false`.

```php

use WS\Utils\Collections\HashSet;

$set1 = new HashSet([1, 2, 3]);
$set2 = new HashSet([3, 2, 1]);
$set3 = new HashSet([3, 2]);

$set1->equals($set2); // true
$set2->equals($set1); // true
$set1->equals($set3); // false

```
#### Получение количества элементов в коллекции
```
size(): int;
```

Метод возвращает число элементов в коллекции. Если коллекция пустая - 0.

```php

use WS\Utils\Collections\CollectionFactory;

$collection = CollectionFactory::from([1, 2, 3]); // [1, 2, 3]
$collection->size(); // 3

$emptyCollection = CollectionFactory::from([]);
$emptyCollection->size(); // false

```
#### Проверка коллекции на пустоту
```
isEmpty(): bool;
```

Метод возвращает признак пустой коллекции. Если в коллекции существуют элементы, вернется `false`.

```php

use WS\Utils\Collections\CollectionFactory;

$collection = CollectionFactory::from([1, 2, 3]); // [1, 2, 3]
$collection->isEmpty(); // false

$emptyCollection = CollectionFactory::from([]);
$emptyCollection->isEmpty(); // true

```
#### Получение элементов коллекции в виде массива
```
toArray(): array;
```

Метод индексированный массив состоящий из элементов коллекции, порядок следования элементов зависит от внутреннего представления.

```php

use WS\Utils\Collections\CollectionFactory;

$collection = CollectionFactory::from([1, 2, 3]); // [1, 2, 3]
$collection->toArray(); // [1, 2, 3]

$emptyCollection = CollectionFactory::from([]);
$emptyCollection->toArray(); // []

```
#### Получение копии коллекции
```
copy(): Collection;
```

Метод возвращает точную копию коллекции. Коллекции - мутабельны. Это означает, что применение методов модификации изменяет коллекцию, для гарантии неизменности коллекции рекомендуется применять метод копирования.

```php

use WS\Utils\Collections\CollectionFactory;

$collection = CollectionFactory::from([1, 2, 3]); // [1, 2, 3]
$copyOfCollection = $collection->copy(); // Collection

$copyOfCollection === $collection; // false

```
#### Получение потока обхода коллекции (Stream)
```
stream(): Stream;
```

Метод объект который реализует интерфейс обхода коллекции (Stream). Поток обхода коллекции является очень мощным инструментом и в большинстве случаев при разработке приходится иметь дело именно с ним. [Подробнее...](#Поток обхода коллекции)

```php

use WS\Utils\Collections\CollectionFactory;

$collection = CollectionFactory::from([1, 2, 3]); // [1, 2, 3]
$collection
    ->stream()
    ->each(static function (int $el) {var_export($el);}); // 1 2 3

```
### Список (ListSequence)
Списком является структура данных в которой строго определен порядок элементов. Списки с одинаковым набором элементов и разной их последовательностью не равны. Интерфейс ListSequence расширяет интерфейс Collection.
#### Методы интерфейса

- [*get* – Получение элемента по порядковому индексу](#Получение-элемента-по-порядковому-индексу)
- [*set* – Замена элемента списка](#Замена-элемента-списка)
- [*indexOf* – Получение порядкового индекса элемента](#Получение-порядкового-индекса-элемента)
- [*lastIndexOf* – Получение порядкового индекса последнего подходящего элемента](#Получение-порядкового-индекса-последнего-подходящего-элемента)
- [*removeAt* – Удаление элемента по индексу](#Удаление-элемента-по-индексу)

#### Получение элемента по порядковому индексу
```
get($index: int): mixed;
```
Метод возвращает элемент по индексу. Если по индексу элемента не существует, вернет null. Первый элемент списка имеет индекс 0.
```php

use WS\Utils\Collections\ArrayList;

$list = ArrayList::of(1, 2);

$list->get(0); // 1
$list->get(1); // 2
$list->get(2); // null

```
#### Замена элемента списка
```
set($element: mixed, $index: int): mixed;
```
Метод заменяет элемент по индексу. Возвращает значение элемента который был заменен текущим методом. Если происходит попытка заменить не существующий элемент, OutOfRangeException будет выброшен.
```php

use WS\Utils\Collections\ArrayList;

$list = ArrayList::of(1, 2);

$list->set(3, 0); // 1
$list->set(4, 1); // 2
$list->set(4, 2); // OutOfRangeException

```
#### Получение порядкового индекса элемента
```
indexOf($element: mixed): ?int;
```
Метод возвращает первый индекс найденного элемента. В случае отсутствия значения в списке, вернется `null`.
```php

use WS\Utils\Collections\ArrayList;

$list = ArrayList::of(1, 2, 1, 3);

$list->indexOf(1); // 0
$list->indexOf(2); // 1
$list->indexOf(4); // null

```
#### Получение порядкового индекса последнего подходящего элемента
```
lastIndexOf($element: mixed): ?int;
```
Метод возвращает последний индекс найденного элемента. В случае отсутствия значения в списке, вернется `null`.
```php

use WS\Utils\Collections\ArrayList;

$list = ArrayList::of(1, 2, 1, 3);

$list->indexOf(1); // 2
$list->indexOf(2); // 1
$list->indexOf(3); // null

```
#### Удаление элемента по индексу
```
removeAt(int $index): mixed;
```
Метод удаляет элемент по индексу, элементы находящиеся после удаленного индекса перемещаются ближе к началу на одну позицию. Возвращает значение удаленного элемента. В случае отсутствия элемента по индексу вернется `null`.
```php

use WS\Utils\Collections\ArrayList;

$list = ArrayList::of(1, 2, 1, 3);

$list->removeAt(1); // 2
$list->toArray(); // [1, 1, 3]

```

### Карта (Map)

### Множество (Set)

### Очередь (Queue)

### Стек (Stack)

## Фабрика создания коллекции

## Потоки обхода коллекций

## Набор функций обхода и преобразования
